<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾é£Ÿå†³ç­–åŠ©æ‰‹ - Iframeå¤‡ç”¨ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="proxy.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        #app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* é¡¶éƒ¨æ§åˆ¶æ  */
        .control-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            position: relative;
        }
        
        .control-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-title .icon {
            font-size: 1.2em;
        }
        
        .control-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .control-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .control-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .control-btn.secondary {
            background: #edf2f7;
            color: #4a5568;
        }
        
        .control-btn.secondary:hover {
            background: #e2e8f0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Iframeå®¹å™¨ */
        .iframe-container {
            flex: 1;
            position: relative;
            background: #f8f9fa;
        }
        
        .iframe-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            z-index: 10;
            transition: opacity 0.5s;
        }
        
        .iframe-loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .iframe-content {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  */
        .status-bar {
            background: #f8f9fa;
            border-top: 1px solid #e2e8f0;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: #718096;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
        }
        
        .status-dot.loading {
            background: #ed8936;
            animation: pulse 1.5s infinite;
        }
        
        .status-dot.error {
            background: #f56565;
        }
        
        /* è­¦å‘Šæ¨ªå¹… */
        .warning-banner {
            background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
            border-left: 4px solid #ed8936;
            padding: 15px 20px;
            margin: 0 20px 20px;
            border-radius: 0 8px 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.5s ease-out;
        }        .warning-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .warning-icon {
            font-size: 1.5em;
            color: #ed8936;
        }
        
        .warning-text {
            color: #c05621;
            font-size: 0.95em;
            line-height: 1.5;
        }
        
        .warning-text a {
            color: #2b6cb0;
            font-weight: 500;
            text-decoration: none;
        }
        
        .warning-text a:hover {
            text-decoration: underline;
        }
        
        .warning-close {
            background: none;
            border: none;
            font-size: 1.2em;
            color: #a0aec0;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .warning-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #718096;
        }
        
        /* é”™è¯¯æç¤º */
        .error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
            z-index: 100;
        }
        
        .error-overlay.active {
            display: flex;
            animation: fadeIn 0.5s;
        }
        
        .error-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #f56565;
        }
        
        .error-title {
            font-size: 1.8em;
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .error-message {
            color: #718096;
            max-width: 500px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        /* å¿«æ·æ“ä½œèœå• */
        .quick-actions {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 100;
        }
        
        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .action-btn.secondary {
            background: #ed8936;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .control-bar {
                padding: 10px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .control-title {
                font-size: 1em;
                order: 1;
                flex: 1;
            }
            
            .control-actions {
                order: 2;
                width: 100%;
                justify-content: center;
                margin-top: 5px;
            }
            
            .control-btn {
                padding: 6px 12px;
                font-size: 0.85em;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                padding: 10px 15px;
            }
            
            .warning-banner {
                margin: 0 10px 15px;
                padding: 12px 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .quick-actions {
                bottom: 70px;
                right: 15px;
            }
            
            .action-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .control-btn .text {
                display: none;
            }
            
            .control-btn {
                padding: 8px;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                justify-content: center;
            }
            
            .warning-text {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>    <div id="app-container">
        <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
        <div class="control-bar">
            <div class="control-title">
                <span class="icon">ğŸ›¡ï¸</span>
                <span>ç¾é£Ÿå†³ç­–åŠ©æ‰‹ - Iframeç‰ˆæœ¬</span>
            </div>
            <div class="control-actions">
                <button class="control-btn" onclick="goToHome()">
                    <span class="icon">ğŸ </span>
                    <span class="text">è¿”å›é¦–é¡µ</span>
                </button>
                <button class="control-btn" onclick="goToSmartProxy()">
                    <span class="icon">ğŸš€</span>
                    <span class="text">æ™ºèƒ½ç‰ˆæœ¬</span>
                </button>
                <button class="control-btn" onclick="refreshFrame()">
                    <span class="icon">ğŸ”„</span>
                    <span class="text">åˆ·æ–°é¡µé¢</span>
                </button>
                <button class="control-btn secondary" onclick="toggleFullscreen()">
                    <span class="icon">â›¶</span>
                    <span class="text">å…¨å±æ¨¡å¼</span>
                </button>
            </div>
        </div>
        
        <!-- è­¦å‘Šæ¨ªå¹… -->
        <div class="warning-banner" id="warningBanner">
            <div class="warning-content">
                <div class="warning-icon">âš ï¸</div>
                <div class="warning-text">
                    <strong>æç¤ºï¼š</strong>æ‚¨æ­£åœ¨ä½¿ç”¨Iframeå¤‡ç”¨ç‰ˆæœ¬ã€‚æŸäº›åŠŸèƒ½å¯èƒ½å—é™ï¼Œæ¨èä½¿ç”¨ 
                    <a href=" " onclick="goToSmartProxy(); return false;">æ™ºèƒ½ç‰ˆæœ¬</a > 
                    è·å¾—æ›´å¥½ä½“éªŒã€‚
                </div>
            </div>
            <button class="warning-close" onclick="hideWarning()">Ã—</button>
        </div>
        
        <!-- Iframeå®¹å™¨ -->
        <div class="iframe-container">
            <!-- åŠ è½½åŠ¨ç”» -->
            <div class="iframe-loading" id="loadingScreen">
                <div class="loading-spinner"></div>
                <div style="color: #667eea; font-weight: 500; margin-bottom: 10px;">æ­£åœ¨åŠ è½½ç¾é£Ÿå†³ç­–åŠ©æ‰‹...</div>
                <div style="color: #718096; font-size: 0.9em; text-align: center; max-width: 400px;">
                    è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨åŠ è½½ç½‘ç«™å†…å®¹
                </div>
            </div>
            
            <!-- é”™è¯¯æç¤º -->
            <div class="error-overlay" id="errorScreen">
                <div class="error-icon">ğŸ˜Ÿ</div>
                <div class="error-title">åŠ è½½å¤±è´¥</div>
                <div class="error-message" id="errorMessage">
                    æ— æ³•åŠ è½½ç¾é£Ÿå†³ç­–åŠ©æ‰‹ã€‚å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–ç½‘ç«™æš‚æ—¶ä¸å¯ç”¨ã€‚
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="control-btn" onclick="retryLoading()">
                        <span class="icon">ğŸ”„</span>
                        é‡æ–°åŠ è½½
                    </button>
                    <button class="control-btn secondary" onclick="goToSmartProxy()">
                        <span class="icon">ğŸš€</span>
                        åˆ‡æ¢åˆ°æ™ºèƒ½ç‰ˆ
                    </button>
                    <button class="control-btn secondary" onclick="goToHome()">
                        <span class="icon">ğŸ </span>
                        è¿”å›é¦–é¡µ
                    </button>
                </div>
            </div>
            
            <!-- Iframeå†…å®¹ -->
            <iframe 
                class="iframe-content" 
                id="contentFrame"
                src="http://dig.ua"
                sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                allow="fullscreen"
                onload="onFrameLoad()"
                onerror="onFrameError()"
            ></iframe>
        </div>
        
        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-info">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">æ­£åœ¨è¿æ¥...</span>
                </div>
                <div id="pageInfo">ç­‰å¾…é¡µé¢åŠ è½½...</div>
            </div>
            <div>
                <span id="currentTime">--:--:--</span>
            </div>
        </div>
        
        <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
        <div class="quick-actions">
            <button class="action-btn" onclick="scrollToTop()" title="å›åˆ°é¡¶éƒ¨">
                â†‘
            </button>
            <button class="action-btn secondary" onclick="openOriginal()" title="åœ¨æ–°çª—å£æ‰“å¼€">
                â†—
            </button>
        </div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            targetUrl: 'http://dig.ua',
            retryCount: 3,
            retryDelay: 3000,
            autoHideWarning: true,
            warningHideTime: 8000
        };

        // çŠ¶æ€ç®¡ç†
        let currentStatus = 'loading'; // loading, loaded, error
        let retryAttempts = 0;
        let isFullscreen = false;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // è‡ªåŠ¨éšè—è­¦å‘Š
            if (CONFIG.autoHideWarning) {
                setTimeout(() => {
                    const warning = document.getElementById('warningBanner');
                    if (warning && warning.style.display !== 'none') {
                        warning.style.opacity = '0';
                        setTimeout(() => {
                            warning.style.display = 'none';
                        }, 500);
                    }
                }, CONFIG.warningHideTime);
            }
            
            // é˜²æ­¢è¢«å…¶ä»–ç½‘ç«™åµŒå…¥
            if (window !== top) {
                top.location = window.location;
            }
        });

        // IframeåŠ è½½æˆåŠŸ
        function onFrameLoad() {
            currentStatus = 'loaded';
            
            // éšè—åŠ è½½åŠ¨ç”»
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.classList.add('hidden');
            
            // æ›´æ–°çŠ¶æ€
            updateStatus('å·²è¿æ¥', 'success');
            
            // æ›´æ–°é¡µé¢ä¿¡æ¯
            try {
                const frame = document.getElementById('contentFrame');
                const pageTitle = frame.contentDocument?.title || 'ç¾é£Ÿå†³ç­–åŠ©æ‰‹';
                document.getElementById('pageInfo').textContent = `é¡µé¢: ${pageTitle}`;
            } catch (e) {
                // è·¨åŸŸé™åˆ¶ï¼Œæ— æ³•è·å–é¡µé¢ä¿¡æ¯
                document.getElementById('pageInfo').textContent = 'é¡µé¢åŠ è½½å®Œæˆ';
            }
            
            // é‡ç½®é‡è¯•è®¡æ•°
            retryAttempts = 0;
            
            console.log('IframeåŠ è½½æˆåŠŸ');
        }

        // IframeåŠ è½½å¤±è´¥
        function onFrameError() {
            if (retryAttempts < CONFIG.retryCount) {
                retryAttempts++;
                updateStatus(`è¿æ¥å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${retryAttempts}/${CONFIG.retryCount})...`, 'loading');
                
                setTimeout(() => {
                    const frame = document.getElementById('contentFrame');
                    frame.src = CONFIG.targetUrl + '?retry=' + Date.now();
                }, CONFIG.retryDelay);
            } else {
                currentStatus = 'error';
                updateStatus('è¿æ¥å¤±è´¥', 'error');
                
                // æ˜¾ç¤ºé”™è¯¯ç•Œé¢
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('errorScreen').classList.add('active');
                
                // è®¾ç½®é”™è¯¯ä¿¡æ¯
                const errorMsg = document.getElementById('errorMessage');
                errorMsg.textContent = `æ— æ³•è¿æ¥åˆ°ç¾é£Ÿå†³ç­–åŠ©æ‰‹ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å°è¯•å…¶ä»–è®¿é—®æ–¹å¼ã€‚`;
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(text, type) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = text;
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            statusDot.classList.remove('loading', 'error');
            
            // æ·»åŠ æ–°çŠ¶æ€ç±»
            if (type === 'loading') {
                statusDot.classList.add('loading');
                statusDot.style.background = '#ed8936';
            } else if (type === 'error') {
                statusDot.classList.add('error');
                statusDot.style.background = '#f56565';
            } else {
                statusDot.style.background = '#48bb78';
            }
        }

        // åˆ·æ–°Iframe
        function refreshFrame() {
            const frame = document.getElementById('contentFrame');
            const loadingScreen = document.getElementById('loadingScreen');
            const errorScreen = document.getElementById('errorScreen');
            
            // é‡ç½®çŠ¶æ€
            loadingScreen.classList.remove('hidden');
            errorScreen.classList.remove('active');
            currentStatus = 'loading';
            updateStatus('æ­£åœ¨åˆ·æ–°...', 'loading');
            
            // é‡æ–°åŠ è½½
            frame.src = CONFIG.targetUrl + '?refresh=' + Date.now();
        }

        // é‡è¯•åŠ è½½
        function retryLoading() {
            retryAttempts = 0;
            refreshFrame();
        }

        // è·³è½¬åˆ°é¦–é¡µ
        function goToHome() {
            window.location.href = '../index.html';
        }

        // è·³è½¬åˆ°æ™ºèƒ½ä»£ç†
        function goToSmartProxy() {
            window.location.href = 'js-proxy.html';
        }

        // éšè—è­¦å‘Š
        function hideWarning() {
            const warning = document.getElementById('warningBanner');
            warning.style.opacity = '0';
            setTimeout(() => {
                warning.style.display = 'none';
            }, 500);
        }

        // åˆ‡æ¢å…¨å±æ¨¡å¼
        function toggleFullscreen() {
            const container = document.getElementById('app-container');
            
            if (!isFullscreen) {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
                isFullscreen = true;
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                isFullscreen = false;
            }
        }

        // å›åˆ°é¡¶éƒ¨
        function scrollToTop() {
            const frame = document.getElementById('contentFrame');
            try {
                frame.contentWindow.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (e) {
                // è·¨åŸŸé™åˆ¶
                frame.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // åœ¨æ–°çª—å£æ‰“å¼€åŸç½‘ç«™
        function openOriginal() {
            window.open(CONFIG.targetUrl, '_blank');
        }

        // æ›´æ–°å½“å‰æ—¶é—´
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case 'r':
                case 'R':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        refreshFrame();
                    }
                    break;
                case 'f':
                case 'F':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    break;
                case 'Escape':
                    if (isFullscreen) {
                        toggleFullscreen();
                    }
                    break;
                case '1':
                    goToHome();
                    break;
                case '2':
                    goToSmartProxy();
                    break;
                case '3':
                    refreshFrame();
                    break;
            }
        });

        // å…¨å±å˜åŒ–ç›‘å¬
        document.addEventListener('fullscreenchange', updateFullscreenState);
        document.addEventListener('webkitfullscreenchange', updateFullscreenState);
        document.addEventListener('msfullscreenchange', updateFullscreenState);

        function updateFullscreenState() {
            isFullscreen = !!(document.fullscreenElement || 
                            document.webkitFullscreenElement || 
                            document.msFullscreenElement);
        }

        // åˆå§‹åŒ–çŠ¶æ€
        updateStatus('æ­£åœ¨è¿æ¥æœåŠ¡å™¨...', 'loading');
    </script>
</body>
</html>
